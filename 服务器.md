#### Ngnix

linux`service nginx start`  或 windows`start ngnix` 
./nginx -s reload 重启配置 kill -HUP pid 

查看nginx报错 `systemctl status nginx.service `

```
gzip  on; #测试压缩后大小
server {
	listen       80;
	server_name  192.168.11.92 localhost; 						  #多个入口
	location / {
		add_header 'Access-Control-Allow-Credentials' 'true';     #添加响应头
        add_header 'Access-Control-Allow-Origin' 'http://192.168.11.92:9001';# 只找到指定IP的跨域办法
        add_header 'Access-Control-Allow-Methods' 'POST,GET,PUT,OPTIONS,DELETE';  
        add_header 'Access-Control-Allow-Headers' 'accept, content-type,X-Requested-With'; 
	    add_header 'Content-Type' 'application/json';             
	    root D:/program/vuetest/mock; 							  #代理到本地文件夹
	}
	location /shop/ {
	    proxy_pass http://gym.gymcity.com.cn; 					  #反向代理到远程IP
	    rewrite ^/shop/(.*) /$1 break; 							  #正则匹配/shop/*
	}
}
```

在HTML5中，有些HTML元素为CORS提供了支持，如img、video新增了crossOrigin属性，属性值可以为anonymous或use-credentials。比如，canvas绘图要用到跨域图片，在JavaScript中要设置`img.crossOrigin="Anonymous";`

root和alias的区别：

```
location /admin {
	root  /admin/res/; // 或者
	alias /admin/res/; // 或者
	index html.html;
	autoindex no;
}
访问地址：localhost/admin/res/app.js;
root 实际访问的地址就是： localhost:8080/admin/res/admin/res/app.js  地址被拼接在root后
alias实际访问的地址就是： localhost:8080/admin/res/app.js            地址替换alias
```

```
//局域网可使用的网段（私网地址段）有三大段：
10.0.0.0~10.255.255.255（A类）
172.16.0.0~172.31.255.255（B类）
192.168.0.0~192.168.255.255（C类）
```

多个server{}用来监听不同域名的80端口

##### 缓存

proxy_cache的作用是缓存后端服务器的内容，包括静态的和动态。fastcgi_cache的作用是缓存fastcgi生成的内容，一般是php生成的内容。

proxy_next_upstream  规定什么是失败的尝试条件，切换服务器重发请求给后端。

缓冲：如果客户端网速卡，可以提前关闭与后端的连接，按网速情况把缓冲到的数据发给客户端。

后端控制nginx不缓存：Cache-Control：`no-cache`(先校验过期，没过期使用缓存) `no-store`(完全不缓存)

##### 负载均衡

```
upstream backend {
    ip_hash; // 按IP分配固定服务器。 不加它默认是时间轮询分配。 
    server 192.168.1.101:7777;
    server 192.168.1.102:8888; 
    server 192.168.1.103:9999;
    fair; //根据后端响应时间调度
}
```

hash $request_uri; // 按url分配固定服务器，需要下载hash包
hash_method crc32; // hash算法

server的后缀关键字：`backup`其他都挂掉的备用服务器 `max_fails=3 fail_timeout=30s` 30秒内失败了3次就认定服务器挂了30秒内不再连接，有默认值 1 10s，取消`max_fails=0`