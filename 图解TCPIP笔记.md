OSI标准：优点-扩展性灵活性。缺点-过分模块化有相似逻辑
  表示层：识别编码格式
  会话层：控制连接的建立和断开的时机
  传输层：实际控制连接的建立和断开。如果接收不完全会告知发送方重发。(交换机：负载均衡 网关：把不同协议转为相同 端口号锁定目标程序)
  网络层：负责端对端发送至目标(路由器 IP锁定目标主机)
  数据链路层：负责发送过程中的每个节点通信(网桥：丢弃损坏数据帧，完整数据则生成新数据帧转发)
  物理层：在数据首部附加MAC地址(中继器：放大电信号并转发 集线器：它每个端口都是一个中继器)
分组传输：数据分组发送有利于多计算机共享通信线路。并在每组写上发送方接收方地址，每遇到一个路由器(队列)会根据地址去向不同的线路，到达目标时重新装配完整报文。
地址分层：MAC不分层，IP分层(某国-某市-小李)。
负载均衡：同域名配置不同IP的DNS。
接入层/汇聚层：高速网络 -> 边缘网络(电信公司->交换机) -> 接入层 -> 个人路由器。 手机基站也是接入层。
数据中心：讲热门访问的数据集合存储直连高速网络。
虚拟云：动态分配物理资源，适应季候性峰值访问。
####2章
TCP/IP协议族：
  传输协议：TCP UDP (传输层)
  网际协议：IP ICMP ARP (网络层)
  路由控制协议：RIP OSPF BGP
  应用协议：HTTP FTP SMTP SNMP TELNET
IP：跨网传送，不会重发
ICMP：IP包发送异常时通知发送方。
ARP：从IP地址解析出MAC地址。
TCP：有连接握手 不适合视频会议。
UDP:无连接 适合广播、视频 握手验证在应用里实现
SMTP：电子邮件
FTP：文件传输、建立2个TCP连接：发请求/发数据
TELNET/SSH：远程登录
SNMP:远程管理设备
数据首部：从上向下流动依次添加各协议首部。都包含源/目标地址、识别上层协议。
发送数据：
  点击发送 -> 
  添加TCP首部(源/目标端口号、序号：标识数据位置、校验和：判定数据损坏) -> 
  添加IP首部(源/目标IP地址、判定数据是TCP/UDP) -> 
  驱动添加以太网首部(源/目标MAC) -> 
  添加末端FCS(传输过程中判定噪声损坏数据) ->
  接收方依次解析首部
####3章 数据链路层
物理层：将电压高低、光的山灭、电波强弱转换为二进制01。数据帧。屏蔽设备/传输媒体的不同。
段：连接中继器的几条网线
总线型和环路型的网络中，会获得所有目标站的帧，通过MAC寻址判定，不是自己的丢弃。
MAC地址：48位bit 识别唯一网卡。不唯一的例外：微机板可设置MAC、虚拟机的虚拟网卡设置的MAC。
共享介质网络：多设备共享相同载波信道，半双工，设备连总线或环线。访问方式：争用式-设备发送时判断电压超过范围视为冲突延时发送。令牌式-设备循环获得发送资格，数据在循环中传输。
非共享介质网络：一对一转发，全双工，设备连交换机。
转发表：数据链路层的每个通过点接到包时会把MAC和发送接口记录在转发表中。交换机第一次是对所有目标发送，有转发记录后是一对一。 
转发方式：存储转发-收到包尾的FCS视为完整数据帧并转发。 直通转发-不检测即时转发。
环路检测：环路会导致异常数据帧被无限转发至拥堵。生成树法：传输时绕行遇到循环转发端口。源路由法：网桥把源地址写入数据。
VLAN:交换机划分几组端口为不同网段。改变设备位置无须修改布线，只修改网段就行。多个交换机只会在相同网段内传输。
以太网帧格式：前导码8个byte,1010~1011。帧体：MAC地址、帧长、LLC、SNAP、数据、FCS。
PPP：1对1的数据链路层协议。CPU需要消耗性能计算ppp帧的标志码。
PPPoE格式:以太网+PPPoE+ppp+数据+FCS。pppoE能利用ppp协议的验证、建立断开连接、按时计费功能。
其它数据链路：
  ATM:把数据包分为最多192个信元，异步发送。适合广域网传输大容量数据。缺陷是丢失1个信元会全部重发。
  光纤通道：用于搭建服务器和多个存储设备的存储域。
  InifiniBand:超高速传输。
IP-VPN：IP层的数据包经过IP-VPN网络被加上标签，离开该网络时去掉标签，形成私有化。
广域以太网：数据链路层的以太网利用VLAN虚拟局域网实现VPN。员工在任何地方都能接入公司内网。
####4章 IP协议
主机：有IP地址的设备。 路由器/网关：有IP地址又能控制路由的设备。 节点：主机和路由器的统称。
网络层：在没有直连的复杂的数据链路节点中实现数据包发给目标地址。
多跳路由：IP包每到一个路由时才知道下一个MAC地址。
特点：无连接、简单、高速。但是接收者无法知道何时会收到，识别会导致错过有效包，不识别会有冗余包。验证由TCP做。
广播：统一网络标识的IP都会收到包。广播地址通常是被路由屏蔽的主机标识如192.168.1.`255`
IPv4：32位正整数，分为8位4组化十进制点号连接。最大值43亿。`192.168.128.10/24`表示中前24个bit是网络标识，最后8bit是主机标识。路由器通过24得知网络标识进行转发。
IPv4分类范围：
  A类255.0.0.0 B类255.255.0.0 C类255.255.255.0 D类255.255.255.255。D类常用在多播，无主机标识。
  子网掩码：`255.255.255.0`标识IP地址前24位是网络号。功能是划分网络号，比ABCD更灵活。
  私有IP：A类10/8 B类172.16/12 C类192.168/16 除此外是公网IP NAT技术：私有IP通过带公网IP的路由器联网。
  默认路由：0.0.0.0/10 主机路由：IP/32 
  环回地址：127.0.0.1，仅用于本机程序通信，不流向网络。
路由控制：
  路由表：如果主机A发的目标IP在主机A的路由表`netstat -r/-rn`上不存在则被转发到默认路由地址。在路由器上的路由控制表发向目标,如果有多条相同网络地址则发送到相同位数最多的目标。
  路由控制表聚合：表条目越少，性能越高。用多个路由器连一个路由器。
IP数据重组：只会被目标主机重组，路由器不会。根据IP首部的识别码重组。
MTU：数据链路层最大传输单元，不包含FCS。IP最大支持65535Byte，最小68，以太网：1500，Jumbo Frame可把以太网提升到9000。
Path MTU:发送时在发送路径找到最小MTU值并缓存10分钟，期间发送数据经过路由器无需二次分片。ICMP负责不断向主机通知更小的MTU值。
IPv6:128bit,32位8组16进制冒号连接。最多连续2个冒号
  环回地址 ::/128 唯一本地地址 FC00::/7 链路本地单播地址 FE80::/10 多播地址 FF00::/8
  分片：只能在发送方主机上分片，路由不分，最小MTU为1280。
IP4首部：
  长:每行32bit，最少5行20Byte
  构成(单位bit)：
  	版本号4 首部长4 TOS服务8 IP包总字节16。 
  	分片标识16 分片信息3 分片内的分段偏移13。 
  	可被转发次数的生存时间8 协议8 防丢失的首部校验和16。 
  	源IP32 目标IP32。可选项320。加0用于调整为32整数倍的填充。
IP6首部：
  构成：
  	版本4，通信量类8，索引流标号20。数据长度16，协议8，转发次限制8，源IP128，目标IP128。扩展首部任意长。
#### IP辅助协议
仅凭IP无法通信。
DNS：域名-IP的数据库 域名查IP`nslookup baidu.com`
  域名服务器：每个域名字段都是一个服务器。从根服务器向下连接，并拥有下层域名服务器的IP。
  DNS解析器：能查询DNS的软件。
  DNS查询顺序：主机1 -> A域名服务器 -> 根域	名服务器 -> 响应B域名服务器IP给A -> A请求B得到主机2的IP响应给主机1 -> 主机1请求主机2
ARP： IP-下个路由MAC IPv4专属
  链路内：源主机广播带IP的ARP -> 目标主机响应带MAC的ARP -> MAC-IP缓存至ARP表内防止多次发送ARP请求。
RARP：给无IP有MAC的嵌入式设备分配IP。
代理ARP：让路由有可转发ARP请求的能力
ICMP：用于IP包被废弃明文回传废弃原因。可有可无。
  消息内容：
  	Destination Unreachable Message:数据不可达，还细分13种消息
  	Redirect Message: 重定向，次优路由路径转向最优。次优路由器会发ICMP把新路径加入到主机的路由控制表内。
  	Time Exceeded Message:因超时丢弃IP包 利用超时检测经过路由器个数`tracert baidu.com`
  	Echo Request Message:回送请求 Echo Reply:回送响应。 `ping`是这个原理。
  	Source Quench Message:原点抑制 网络拥堵，让发送方打开IP传输间隔。
  	Router Solicitaion/Advertisement:探索相邻路由器/返回路由器信息
  	Address Mask Request/Reply:请求子网掩码 
ICMPv6:必须有。
  Neighbor Discovery功能：ARP ICMP重定向 自动设置IP
  错误消息：0~127
  信息消息：128~255
DHCP：
  顺序：客户端广播DHCP发现包 -> DHCP服务器返回DHCP提供包。 DHCP服务器发送ICMP回送请求包且无响应（防止IP已有） -> DHCP客户端发送ARP且无响应。
  DHCP中继代理：中间路由集体请求服务器 由一个DHCP服务器统一分配IP
NAT:
  NAT：私有IP发送到NAT，IP首部的发送方IP转为NAT的公网IP。 
  NAPT：如果多个私有IP发送同一个目标，转换表源IP用不同端口号区分。
  NAT-PT/NAPT-PT:把IPv6的首部转为IPv4的首部。
  缺点：NAT外部无法对内连接，NAT异常会导致TCP连接断开。
IP隧道：多层IP首部,IP4包IP6能让IP6包跨越IP4网到另一边的IP6网。
RSVP：接收端对发送端发送控制包监控流量。
DiffServ:替换该域IP包首部的DSCP字段设优先级，拥堵丢弃低优先包。
ECN:网络拥堵,替换IP首部的TOS为ECN。如果目标主机得知网络拥堵则在响应TCP首部追加CWR和ECE。
Mobile IP:IP经常变的移动设备通过代理连接能解决IP变则TCP断开的问题。
#### TCP UDP
顺序：发送端TCP发送到接收端的inetd超级守护进程，由它识别端口号fork并exec到对应守护进程。
顺序：数据链路-IP-TCP-recv() send()-TCP-IP
流：发送时有顺序，接受不一定。
知名端口号：0-1023 已注册端口号：1024-49151 动态分配端口号：49152-65535
不同协议可使用相同端口号。


TCP:
  顺序、约6秒重发、流量控制、拥堵控制、分包顺序控制。
  SYN包建立连接，FIN包断开连接。
  检验：
   1. 检验和  
   2. 序列号： 发送数据的每个字节加编号，初始值为随机数，按顺序+1，每次通信数据长度>1，所以（ACK序列号-发送序列号）>1
   3. 确认应答ACK/否定应答NACK ： 发送端超时没收到ACK就重发。可能是发送丢包或者ACK丢包。后者接收端会丢弃重复数据。ACK包括下步应接收数据的序列号。
   4. 重发控制：超时=（往返时间+时间波动值），每次发包动态计算一次。初始值是6秒。必须是0.5秒整数倍,每重发一次时间以幂递增，超过最大重发次数（12次/9分钟）则关闭TCP连接。
   5. 连接管理：发送SYN包->响应ACK+SYN->发送ACK->连接已建立！ 发送FIN包->响应ACK+FIN->发送ACK->连接已关闭！
   6. 窗口控制：异步发送多个段，接收多个ACK。报文段丢失则ACK永远指向该序列号，发送方收到3次相同序列号ACK则重发。ACK丢失，下个ACK也能让窗口向后滑动。 
   7. 流控制/窗口大小：写入TCP首部，发送方随对方缓冲区负载调整并发数。窗口探测包->响应窗口更新通知。解决了接收端缓冲区过载丢弃数据。
   8. 拥堵控制/慢启动：初始窗口大小为1，收到1个ACK，窗口+1。和流控制做比较取最小值。慢启动解决了刚开始发送数据过大造成网络拥堵。慢启动阀值为已发送没ACK数据量的一半。
  缓冲区：没收到ACK，对应段就不移出缓冲区，以便重发。
  最大消息长度MSS：SYN包告知最小值写入TCP首部。这是1个段，对应1个ACK。
  Nagle算法：满足其一才发送：ACK全部收到，MSS超过最大值。优点：网络利用率。缺点：网络延迟。窗口系统会关闭该算法。
  延迟ACK：刚收到数据时缓冲区是慢的，窗口大小不准，所以延迟0.2-0.5秒。
  捎带应答：延迟ACK和回执合并为一个包发送。
UDP：不重发
  UDP首部：源端口号16，目标端口16，包总长8字节，校验和16.
#### 其它传输层协议
UDP-Lite:功能和UDP一样，只是能自定义校验和范围，不符合的包丢弃。范围设小后，其它部分有损毁仍然进行处理。
SCTP:类似TCP，它能知道消息大小，支持多IP(有线切wifi不断连接)
DCCP：配合UDP实现拥堵控制。