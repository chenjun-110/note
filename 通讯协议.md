# 图解TCP/IP

OSI标准：优点-扩展性灵活性。缺点-过分模块化有相似逻辑
  应用层：与对端主机交互
  表示层：识别转换编码格式
  会话层：控制连接的建立和断开的时机
  传输层：实际控制连接的建立和断开。如果接收不完全会告知发送方重发。(交换机：负载均衡 网关：把不同协议转为相同 端口号锁定目标程序)
  网络层：负责端对端发送至目标(路由器 IP锁定目标主机)
  数据链路层：负责发送过程中的每个节点通信(网桥：丢弃损坏数据帧，完整数据则生成新数据帧转发)
  物理层：在数据首部附加MAC地址(中继器：放大电信号并转发 集线器：它每个端口都是一个中继器)
传输层以下属于操作系统，以上属于应用程序的应用协议。它不需要关心数据如何发送。
分组传输：数据分组发送有利于多计算机共享通信线路。并在每组写上发送方接收方地址，每遇到一个路由器(队列)会根据地址去向不同的线路，到达目标时重新装配完整报文。
地址分层：MAC不分层，IP分层(某国-某市-小李)。
负载均衡：同域名配置不同IP的DNS。
接入层/汇聚层：高速网络 -> 边缘网络(电信公司->交换机) -> 接入层 -> 个人路由器。 手机基站也是接入层。
数据中心：讲热门访问的数据集合存储直连高速网络。
虚拟云：动态分配物理资源，适应季候性峰值访问。
####2章
TCP/IP协议族：
  传输协议：TCP UDP (传输层)
  网际协议：IP ICMP ARP (网络层)
  路由控制协议：RIP OSPF BGP
  应用协议：HTTP FTP SMTP SNMP TELNET
IP：跨网传送，不会重发
ICMP：IP包发送异常时通知发送方。
ARP：从IP地址解析出MAC地址。
TCP：有连接握手 不适合视频会议。
UDP:无连接 适合广播、视频 握手验证在应用里实现
SMTP：电子邮件
FTP：文件传输、建立2个TCP连接：发请求/发数据
TELNET/SSH：远程登录
SNMP:远程管理设备
数据首部：从上向下流动依次添加各协议首部。都包含源/目标地址、识别上层协议。
发送数据：
  点击发送 -> 
  添加TCP首部(源/目标端口号、序号：标识数据位置、校验和：判定数据损坏) -> 
  添加IP首部(源/目标IP地址、判定数据是TCP/UDP) -> 
  驱动添加以太网首部(源/目标MAC) -> 
  添加末端FCS(传输过程中判定噪声损坏数据) ->
  接收方依次解析首部
####3章 数据链路层
物理层：将电压高低、光的山灭、电波强弱转换为二进制01。数据帧。屏蔽设备/传输媒体的不同。
段：连接中继器的几条网线
总线型和环路型的网络中，会获得所有目标站的帧，通过MAC寻址判定，不是自己的丢弃。
MAC地址：48位bit 识别唯一网卡。不唯一的例外：微机板可设置MAC、虚拟机的虚拟网卡设置的MAC。
共享介质网络：多设备共享相同载波信道，半双工，设备连总线或环线。访问方式：争用式-设备发送时判断电压超过范围视为冲突延时发送。令牌式-设备循环获得发送资格，数据在循环中传输。
非共享介质网络：一对一转发，全双工，设备连交换机。
转发表：数据链路层的每个通过点接到包时会把MAC和发送接口记录在转发表中。交换机第一次是对所有目标发送，有转发记录后是一对一。 
转发方式：存储转发-收到包尾的FCS视为完整数据帧并转发。 直通转发-不检测即时转发。
环路检测：环路会导致异常数据帧被无限转发至拥堵。生成树法：传输时绕行遇到循环转发端口。源路由法：网桥把源地址写入数据。
VLAN:交换机划分几组端口为不同网段。改变设备位置无须修改布线，只修改网段就行。多个交换机只会在相同网段内传输。
以太网帧格式：前导码8个byte,1010~1011。帧体：MAC地址、帧长、LLC、SNAP、数据、FCS。
PPP：1对1的数据链路层协议。CPU需要消耗性能计算ppp帧的标志码。
PPPoE格式:以太网+PPPoE+ppp+数据+FCS。pppoE能利用ppp协议的验证、建立断开连接、按时计费功能。
其它数据链路：
  ATM:把数据包分为最多192个信元，异步发送。适合广域网传输大容量数据。缺陷是丢失1个信元会全部重发。
  光纤通道：用于搭建服务器和多个存储设备的存储域。
  InifiniBand:超高速传输。
IP-VPN：IP层的数据包经过IP-VPN网络被加上标签，离开该网络时去掉标签，形成私有化。
广域以太网：数据链路层的以太网利用VLAN虚拟局域网实现VPN。员工在任何地方都能接入公司内网。
####4章 IP协议
主机：有IP地址的设备。 路由器/网关：有IP地址又能控制路由的设备。 节点：主机和路由器的统称。
网络层：在没有直连的复杂的数据链路节点中实现数据包发给目标地址。
多跳路由：IP包每到一个路由时才知道下一个MAC地址。
特点：无连接、简单、高速。但是接收者无法知道何时会收到，识别会导致错过有效包，不识别会有冗余包。验证由TCP做。
广播：统一网络标识的IP都会收到包。广播地址通常是被路由屏蔽的主机标识如192.168.1.`255`
IPv4：32位正整数，分为8位4组化十进制点号连接。最大值43亿。`192.168.128.10/24`表示中前24个bit是网络标识，最后8bit是主机标识。路由器通过24得知网络标识进行转发。
IPv4分类范围：
  A类255.0.0.0 B类255.255.0.0 C类255.255.255.0 D类255.255.255.255。D类常用在多播，无主机标识。
  子网掩码：`255.255.255.0`标识IP地址前24位是网络号。功能是划分网络号，比ABCD更灵活。
  私有IP：A类10/8 B类172.16/12 C类192.168/16 除此外是公网IP NAT技术：私有IP通过带公网IP的路由器联网。
  默认路由：0.0.0.0/10 主机路由：IP/32 
  环回地址：127.0.0.1，仅用于本机程序通信，不流向网络。
路由控制：
  路由表：如果主机A发的目标IP在主机A的路由表`netstat -r/-rn`上不存在则被转发到默认路由地址。在路由器上的路由控制表发向目标,如果有多条相同网络地址则发送到相同位数最多的目标。
  路由控制表聚合：表条目越少，性能越高。用多个路由器连一个路由器。
IP数据重组：只会被目标主机重组，路由器不会。根据IP首部的识别码重组。
MTU：数据链路层最大传输单元，不包含FCS。IP最大支持65535Byte，最小68，以太网：1500，Jumbo Frame可把以太网提升到9000。
Path MTU:发送时在发送路径找到最小MTU值并缓存10分钟，期间发送数据经过路由器无需二次分片。ICMP负责不断向主机通知更小的MTU值。
IPv6:128bit,32位8组16进制冒号连接。最多连续2个冒号
  环回地址 ::/128 唯一本地地址 FC00::/7 链路本地单播地址 FE80::/10 多播地址 FF00::/8
  分片：只能在发送方主机上分片，路由不分，最小MTU为1280。
IP4首部：
  长:每行32bit，最少5行20Byte
  构成(单位bit)：
  	版本号4 首部长4 TOS服务8 IP包总字节16。 
  	分片标识16 分片信息3 分片内的分段偏移13。 
  	可被转发次数的生存时间8 协议8 防丢失的首部校验和16。 
  	源IP32 目标IP32。可选项320。加0用于调整为32整数倍的填充。
IP6首部：
  构成：
  	版本4，通信量类8，索引流标号20。数据长度16，协议8，转发次限制8，源IP128，目标IP128。扩展首部任意长。

#### IP辅助协议
仅凭IP无法通信。
DNS：域名-IP的数据库 域名查IP`nslookup baidu.com`
  域名服务器：每个域名字段都是一个服务器。从根服务器向下连接，并拥有下层域名服务器的IP。
  DNS解析器：能查询DNS的软件。
  DNS查询顺序：主机1 -> A域名服务器 -> 根域	名服务器 -> 响应B域名服务器IP给A -> A请求B得到主机2的IP响应给主机1 -> 主机1请求主机2
ARP： IP-下个路由MAC IPv4专属
  链路内：源主机广播带IP的ARP -> 目标主机响应带MAC的ARP -> MAC-IP缓存至ARP表内防止多次发送ARP请求。
RARP：给无IP有MAC的嵌入式设备分配IP。
代理ARP：让路由有可转发ARP请求的能力
ICMP：用于IP包被废弃明文回传废弃原因。可有可无。
  消息内容：
  	Destination Unreachable Message:数据不可达，还细分13种消息
  	Redirect Message: 重定向，次优路由路径转向最优。次优路由器会发ICMP把新路径加入到主机的路由控制表内。
  	Time Exceeded Message:因超时丢弃IP包 利用超时检测经过路由器个数`tracert baidu.com`
  	Echo Request Message:回送请求 Echo Reply:回送响应。 `ping`是这个原理。
  	Source Quench Message:原点抑制 网络拥堵，让发送方打开IP传输间隔。
  	Router Solicitaion/Advertisement:探索相邻路由器/返回路由器信息
  	Address Mask Request/Reply:请求子网掩码 
ICMPv6:必须有。
  Neighbor Discovery功能：ARP ICMP重定向 自动设置IP
  错误消息：0~127
  信息消息：128~255
DHCP：
  顺序：客户端广播DHCP发现包 -> DHCP服务器返回DHCP提供包。 DHCP服务器发送ICMP回送请求包且无响应（防止IP已有） -> DHCP客户端发送ARP且无响应。
  DHCP中继代理：中间路由集体请求服务器 由一个DHCP服务器统一分配IP
NAT:
  NAT：私有IP发送到NAT，IP首部的发送方IP转为NAT的公网IP。 
  NAPT：如果多个私有IP发送同一个目标，转换表源IP用不同端口号区分。
  NAT-PT/NAPT-PT:把IPv6的首部转为IPv4的首部。
  缺点：NAT外部无法对内连接，NAT异常会导致TCP连接断开。
IP隧道：多层IP首部,IP4包IP6能让IP6包跨越IP4网到另一边的IP6网。
RSVP：接收端对发送端发送控制包监控流量。
DiffServ:替换该域IP包首部的DSCP字段设优先级，拥堵丢弃低优先包。
ECN:网络拥堵,替换IP首部的TOS为ECN。如果目标主机得知网络拥堵则在响应TCP首部追加CWR和ECE。
Mobile IP:IP经常变的移动设备通过代理连接能解决IP变则TCP断开的问题。
#### TCP UDP
顺序：发送端TCP发送到接收端的inetd超级守护进程，由它识别端口号fork并exec到对应守护进程。
顺序：数据链路-IP-TCP-recv() send()-TCP-IP
流：发送时有顺序，接受不一定。
知名端口号：0-1023 已注册端口号：1024-49151 动态分配端口号：49152-65535
不同协议可使用相同端口号。


TCP:
  顺序、约6秒重发、流量控制、拥堵控制、分包顺序控制。
  SYN包:建立连接，FIN包:断开连接。
  检验：
   1. 检验和  
   2. 序列号： 发送数据的每个字节加编号，初始值为随机数，按顺序+1，每次通信数据长度>1，所以（ACK序列号-发送序列号）>1
   3. 确认应答ACK/否定应答NACK ： 发送端超时没收到ACK就重发。可能是发送丢包或者ACK丢包。后者接收端会丢弃重复数据。ACK包括下步应接收数据的序列号。
   4. 重发控制：超时=（往返时间+时间波动值），每次发包动态计算一次。初始值是6秒。必须是0.5秒整数倍,每重发一次时间以幂递增，超过最大重发次数（12次/9分钟）则关闭TCP连接。
   5. 连接管理：发送SYN包->响应ACK+SYN->发送ACK->连接已建立！ 发送FIN包->响应ACK+FIN->发送ACK->连接已关闭！
   6. 窗口控制：异步发送多个段，接收多个ACK。报文段丢失则ACK永远指向该序列号，发送方收到3次相同序列号ACK则重发。ACK丢失，下个ACK也能让窗口向后滑动。 
   7. 流控制/窗口大小：写入TCP首部，发送方随对方缓冲区负载调整并发数。窗口探测包->响应窗口更新通知。解决了接收端缓冲区过载丢弃数据。
   8. 拥堵控制/慢启动：初始窗口大小为1，收到1个ACK，窗口+1。和流控制做比较取最小值。慢启动解决了刚开始发送数据过大造成网络拥堵。慢启动阀值为已发送没ACK数据量的一半。
    缓冲区：没收到ACK，对应段就不移出缓冲区，以便重发。
    最大消息长度MSS：SYN包告知最小值写入TCP首部。这是1个段，对应1个ACK。
    Nagle算法：满足其一才发送：ACK全部收到，MSS超过最大值。优点：网络利用率。缺点：网络延迟。窗口系统会关闭该算法。
    延迟ACK：刚收到数据时缓冲区是慢的，窗口大小不准，所以延迟0.2-0.5秒。
    捎带应答：延迟ACK和回执合并为一个包发送。
    TCP首部：
    源端口号16，目标端口号16，
    序列号32：每发送一次累加字节数大小，初始值是随机数。	
    ACK号32:也是序列号，已收到数据的序列号+1.
    数据偏移32：表示首部长度，用于索引数据部分。如5表示前20字节是首部。
    保留4：暂时无用。
    控制位8：每位有特殊作用分别是
      CWR:用于IP首部的ECN。
      ECE:值为1 网络拥堵，窗口应缩小。
      URG:值为1 带有紧急数据。
      ACK：值为1 ACK包有效
      PSH：值为1 数据不缓存立即传入应用层协议。
      RST：值为1 TCP异常，收包立即断开连接。
      SYN：值为1 请求连接
      FIN：值为1 请求断连，收到FIN方等缓冲数据发送完毕并删除后发送FIN。
    窗口大小16：最大数据，为0表示可发送窗口探测包。
    校验和：检测本包是否被破坏。
    紧急指针16：指出了紧急数据末尾在报文中的位置。
    选项：32的整数倍。
  吞吐量：为（窗口大小/往返时间）。游览器会创4个连接提高吞吐量。
UDP：不重发
  UDP首部：源端口号16，目标端口16，包总长8字节，校验和16.

#### 其它传输层协议
UDP-Lite:功能和UDP一样，只是能自定义校验和范围，不符合的包丢弃。范围设小后，其它部分有损毁仍然进行处理。
SCTP:类似TCP，它能知道消息大小，支持多IP(有线切wifi不断连接)
DCCP：配合UDP实现拥堵控制。

#### 路由协议
动态路由：路由器相互发送自己的信息，路由器不能循环连接。
外部网关协议EGP：包括BGP协议等
内部网关协议IGP：包括RIP、RIP2、OSPF协议等。
距离向量算法：包向距离短的地方走。路由器只有相邻信息。
链路状态算法：路由器有相同的路由信息。
RIP:下层UDP 距离向量 30秒广播路由信息，6次无响应断开连接。距离向量数据库记录了IP、目标IP、跳数。由此生成路由控制表。	该协议可选择经过路由器最少的路。
RIP2：下层UDP 距离向量 该协议可选择代价最低的路。体内有本区域所有路由器的完整拓扑数据库
OSFP:下层IP 链路状态
EGP:下层IP 距离向量
BGP：下层TCP 路径向量
MPLS:用标记生成虚拟路径，速度快。
#### 应用协议
远程登录：
 TELNET：无需密码。1.仿真终端：发送文字指令至远程shell  2.协商选项：行模式-每输入一行发送一次，透明模式-每输入一个字符发送一次。 常用于登录路由器和交换机，跟踪诊断网络调试。`telnet 主机名 TCP端口号`如果连接21端口，则等价于ftp命令。
 SSH:加密版远程登录。
  端口转发：应用->ssh->ssh服务器->应用。ssh之间是加密的，之外是普通TCP连接，共3条。
文件传输ftp：2条TCP，
 一条控制：响应命令之用，用ASCII码。
 一条传输：只存活于传输时
电子邮件
 SMTP：发送方->本域邮件服务器->它域邮件服务器->接收方。 发送文本，响应3位数字。
 POP:邮件被发到POP服务器，接收方开机后拉取数据。
 IMAP：类似POP，区别是客户端可选择性下载数据。
HTTP1.1：1条TCP，1.0每个命令都会增减TCP。
 CGI：web服务器调用外部程序的规范。
 博客：不需要懂HTML的应用。
 RSS:内容更新摘要信息的数据格式。
网络管理
 SNMP:可通过RMON监控正在进行通信的协议。
多媒体
 H.323协议栈
 SIP:比H.323简单，有呼叫控制。
 RTP:
POP：没有中间服务器，点对点。但在NAT里不行。
LDAP:目录协议
#### 网络安全
防火墙：针对非白名单，过滤掉非指定端口的包。只接受内网TCP连接
IDS：检测已经侵入内部的数据包。日志、监控、通知异常。
加密：
  加密：用公钥+算法加密
  解密：用私钥+算法解密。
  对称加密：只有一种密钥，AES、DES算法。
  公钥加密：公钥和私钥，拿对方的公钥加密发送，对方用我的公钥发送的就可以用我的私钥解密。RSA、DH、椭圆曲线算法。
身份认证：
  持有信息：密码、服务器有你的公钥，你是否持有私钥。
  拥有信息：电话号码、电子证书、指纹、视网膜。
安全协议：
  VPN/IPsec:
     传输模式：主机在IP首部后TCP首部前加ESP首部，包尾加ESP认证。由主机做加密解密。
	 隧道模式：经过VPN路由器执行加密，方式同上。由路由器做加密解密。
  TLS/SSL-HTTPS：客户端HTTPS请求 -> 响应(服务端公钥)和被加密的证书 -> 用证书公钥解密证书并发送自己的(客户端公钥)
  IEEE802.1X：数据链路层协议，用于公共无线网。用户连接无线 -> 分配认证服务器的临时IP -> 输入密码后路由器切换VLAN为公网。

# 图解HTTP

HTTP-TCP-IP-以太网 发送端加首部 接收端反向减首部

互联网设备无法保存全部细节，各自保存相邻节点。

TCP有字节流，用报文段切分数据包。接收方负责整合数据包。

IP负责寻址传送

协议本身不保存状态，状态由Cookie保存。

#### 请求方式

GET   查询数据

HEAD 查询响应首部 

POST 传输数据

PUT    传输文件 

DELETE 删除文件 

OPTIONS  查询支持的请求方式 

TRACE：追踪路径 Max-Forwards 首部每经过一个代理服务器就减 1，当数值减到 0 时停止传输立即返回响应。通过响应 Max-Forwards 值计算服务器中转数,测算哪个代理出bug了 。易引发XST跨站追踪攻击 

CONNECT： 要求用隧道协议连接代理 用 SSL和 TLS把内容加密后经网络隧道传输。 

keep-alive 防止大量图片请求导致TCP连接频繁断连。在 HTTP/1.1 中，所有连接默认keep-alive 。在它基础上的 pipelining 可不等响应并发请求。



![HTTP握手图片](D:\note\HTTP握手图片.png)

分块传输编码：逐步显示html

#### 多部分对象集合 

需要 Content-type 字段，每个部分都可以含有首部 

multipart/form-data    表单文件上传 

multipart/byteranges  状态码206响应报文包含了多个范围的内容

范围请求首部：`Range: bytes=5001- ` 只请求5001字节后的剩余字节返回`206`，如果服务器拒绝会返回`200`完整数据。

#### 状态码

1XX Informational（信息性状态码） 接收的请求正在处理 

2XX Success（成功状态码） 请求正常处理完毕

3XX Redirection（重定向状态码） 需要进行附加操作以完成请求 

4XX Client Error（客户端错误状态码） 服务器无法处理请求 

5XX Server Error（服务器错误状态码） 服务器处理请求出错 



204 请求成功 不返回报文主体

206 范围请求 响应Content-Range指定范围 

301 永久重定向 资源已被分配了新的 URI 

302 临时重定向 307也是

303 存在其他URI 应当采用 GET 方法获取资源 301、302、303大部分浏览器会把 POST 改成 GET，并删除报文主体，再次发送请求。 

304 发送附带条件请求，但未满足条件 附带条件首部：If-Match，If-ModifiedSince，If-None-Match，If-Range，If-Unmodified-Since 

400 报文语法错误 

401 需要HTTP认证或认证失败

403 服务器拒绝 404也是

500 服务器故障 

503 服务器超负载或停机维护

#### HTTP首部

代理可以过滤数据，网关只能转发数据和修改通讯协议。隧道只负责安全传输不加工数据。

##### 通用首部 

`Via` 代理服务器的相关信息 

`Date` 创建报文的日期时间 

`Trailer` 报文末端的首部一览 

`Pragma` 报文指令 

`Warning` 错误通知 

`Upgrade` 升级为其他协议 

`Connection` 逐跳首部、连接的管理 

`Cache-Control` 控制缓存的行为 

`Transfer-Encoding` 指定报文主体的传输编码方式 

##### 请求首部 

`Accept` 用户代理可处理的媒体类型 

`Accept-Charset` 优先的字符集 

`Accept-Encoding` 内容编码压缩方式

`Accept-Language` 优先的语言

`Authorization` Web认证

`Expect` 期待服务器的特定行为 

`From` 用户的电子邮箱地址 

`Host` 响应方地址 (比如api.hahaloo.cn)

`Referer` 请求方的完整URI

`If-Match` 比较实体标记（ETag） 

`If-Modified-Since` 比较资源的更新时间 

`If-None-Match` 比较实体标记（与 If-Match 相反） 

`If-Range` 资源未更新时发送实体 Byte 的范围请求 

`If-Unmodified-Since` 比较资源的更新时间（与If-Modified-Since相反） 

`Max-Forwards` 最大传输逐跳数 

`Proxy-Authorization` 代理服务器要求客户端的认证信息 

`Range` 实体的字节范围请求 

`TE` 节点对节点传输过程中的编码压缩方式

`User-Agent` HTTP客户端程序的信息 

##### 响应首部 

`Accept-Ranges` 是否接受字节范围请求 

`Age` 响应创建到现在的时间

`ETag` 资源的唯一标识，更新资源时由服务器生成

`Location` 令客户端强制重定向至指定URI 3XX

`Proxy-Authenticate` 代理服务器对客户端的认证信息 

`Retry-After` 稍后重发请求 

`Server` HTTP服务器的安装信息 

`Vary` 代理服务器缓存的管理信息 

`WWW-Authenticate` 服务器对客户端的认证信息 

`Allow` 支持的HTTP方法 

`Content-Encoding` 实体主体适用的编码方式 

`Content-Language` 实体主体的自然语言 

`Content-Length` 实体主体的大小（单位：字节） 不适用压缩后

`Content-Location` 资源的URI 

`Content-MD5` 实体主体的报文摘要 无法解决篡改

`Content-Range` 实体主体的位置范围 

`Content-Type` 实体主体的媒体类型 

`Expires` 缓存过期那天的日期 

`Last-Modified` 资源的最后修改日期时间 

端到端首部必须被转发。

逐跳首部：只对单次转发有效，需设置Connection首部。 `Connection Keep-Alive Proxy-Authenticate Proxy-Authorization Trailer TE Transfer-Encoding Upgrade `除了这8个都是端对端首部。

##### Cache-Control 

请求 ：no-cache 强制向源服务器再次验证 no-store 不缓存请求或响应的任何内容 max-age = [ 秒] 响应的最大Age值 max-stale( = [ 秒]) 接收已过期的响应 min-fresh = [ 秒] 期望在指定时间内的响应仍有效 no-transform 代理不可更改媒体类型 only-if-cached 从缓存获取资源 cache-extension - 新指令标记（token） 

响应： public 可向任意方提供响应的缓存 private 仅向特定用户返回响应 no-cache 缓存前必须先确认其有效性 no-store 不缓存请求或响应的任何内容 no-transform 代理不可更改媒体类型 must-revalidate 可缓存但必须再向源服务器进行确认 proxy-revalidate 要求中间缓存服务器对缓存的响应有效性再 进行确认 max-age = [ 秒] 响应的最大Age值 s-maxage = [ 秒] 公共缓存服务器响应的最大Age值 cache-extension - 新指令标记（token） 

`private` 代理服务器只对指定用户返回缓存

`no-cache` 代理可缓存但强制验证

`no-store`  禁止缓存

`s-maxage` 只适合代理，优先级比 max-age Expires 高

`max-age ` 代理不验证有效性，优先级比 Expires 高

`min-fresh`=60 当前时间加上60秒过期了则不用缓存

`max-stale` =60 即使过期60秒仍然接受

` only-if-cached ` 只请求代理的缓存，不和源服务器通讯，无缓存就504

`must-revalidate ` 代理强制验证缓存，否则504。 `proxy-revalidate`类似

`no-transform `  缓存都不能改变实体的媒体类型,防止图片被压缩。

##### 条件请求

服务器接 收到附带条件的请求后，只有判断指定条件为真时，才会执行请求。 

`If-Match`的值要与服务器资源的`ETag`的值相等，否则412拒绝。`If-None-Match `相反，与`ETag`不等。

`If-Modified-Since`  指定日期后有改动则处理请求,无改动返304。响应 `Last-Modified `是改动日期。 `If-Unmodified-Since ` 日期后无改动才处理请求否则412拒绝。

`If-Range `与`ETag`的值相等当作范围请求，否则返回全体资源。

##### 安全相关头

###### Set-Cookie 

`NAME=VALUE` 赋予 Cookie 的名称和其值（必需项） 

`expires=DATE` 有效期（默认为浏览器关闭前） 

`path=PATH` 适用文件目录（默认为文档所在目录）可绕开限制

`domain=域名` 适用域名 （默认为创建服务器的域名） 格式可忽略www前缀

`Secure` 仅HTTPS才发送 Cookie 

`HttpOnly`  Cookie 不能被 JS访问 

###### X-Frame-Options

 `DENY `页面不能被嵌入到任何iframe或frame中； 

`SAMEORIGIN `页面只能被本站页面嵌入到iframe或者frame中； 可预防点击劫持(透明iframe)

`ALLOW-FROM` 页面允许frame或frame加载。 

###### X-XSS-Protection 

0 关闭XSS防护

1 删除恶意代码 默认。可能会误删，恶意代码中出现jq就会把jq库删除。

1；mode=block 不渲染恶意代码 谷歌默认。 比1稍好，仍有漏洞。

###### DNT

0 同意被广告追踪

1 拒绝被广告追踪 防止三方统计

P3P隐私头

#### HTTPS

不加密的数据包会被相同网段/不同节点的人抓包

HTTPS = HTTP + 加密报文主体 + SSL认证 + 确保完整性防篡改

混合加密机制：交换密钥环节采用公私钥方式，通信阶段采用同一密钥加解密(为了性能)。

#### 登陆认证

Basic认证：请求时响应带 WWW-Authenticate头 （需要Basic认证）的资源时发送`用户名:密码`base64化写入`Authorization`头。DIGST认证比Basic稍好。

SSL认证：用收费证书认证计算机身份，用表单密码认证本人身份。

session: 输入用户名密码从后端换回带httpOnly的sessionID，用sessionID表示已登陆。

#### 其他协议

SPDY 单TCP连接无限制并发请求，可设置请求优先级，压缩首部，服务器推送。缺点只适用单域名资源。类似WebSocket 

HTTP2.0

WebDAV 文件系统



文件名要不可推测

错误消息不能太详细，让黑客推理出破绽。